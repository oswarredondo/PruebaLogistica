Ext.define('MyDesktop.grid.GridManifiestoFXC', {    extend: 'Ext.grid.Panel',    requires: [        'Ext.grid.column.Action',        'Ext.grid.plugin.CellEditing',        'Ext.form.field.Text',        'Ext.toolbar.TextItem',        'Ext.ux.form.MultiSelect'    ],    stateful: true,    collapsible: false,    multiSelect: true,    stateId: 'stateGridManifiestoFXC',    viewConfig: {        stripeRows: true,        enableTextSelection: true    },	id:undefined,	isConsulta:false,	myScope:undefined,	tipo_translado:'F',	tiporegistro:'',    initComponent: function () {    	    	    	var ismenuDesabled=true;		this.myScope = this;		var my_scope = this;		this.store = Ext.create('MyDesktop.store.StoreHistoria',{			//model: 'MyDesktop.models.ModeloDocumento',			proxy: {		        type: 'ajax',		        api: {		            read: '../logproceso/getGuiasTramosViajes?tiporegistro='+my_scope.tiporegistro		        },		        reader: {		                 type: 'json',		                 successProperty: 'success',		                 root : 'proxiArray',		                 messageProperty: 'message',		                 totalProperty : 'totalCount',		        }			}					});		this.selType= 'checkboxmodel';		 this.editing = Ext.create('Ext.grid.plugin.CellEditing',{clicksToEdit: 1});		 this.plugins = this.editing;		 		var sm = Ext.create('Ext.selection.CheckboxModel',{mode : 'MULTI'});		this.selModel= sm;		this.loadMask=true;		        this.columns = [				{text     : 'IdGuia',width: 250,sortable : false,dataIndex: 'idenvio'},				{text     : 'Fecha',width: 170,sortable : false,dataIndex: 'fecha'},				{text     : 'Excepcion',width: 90,sortable : false,dataIndex: 'exclave'},				{text     : 'Plaza',width: 100,sortable : false,dataIndex: 'plazaorigina'},				{text     : 'Monto',width: 100,sortable : false,dataIndex: 'monto'},								//{text     : 'Viaje',width: 150,sortable : false,dataIndex: 'viaje'},				//{text     : 'Tramo',width: 150,sortable : false,dataIndex: 'ruta'},				//{text     : 'Cincho',width: 120,sortable : false,dataIndex: 'cincho'},				//{text     : 'Economico',width: 120,sortable : false,dataIndex: 'numeconomico'},				//{text     : 'Empleado',width: 100,sortable : false,dataIndex: 'empleado', hidden:true},				{text     : 'Manifiesto',width: 200,sortable : false,dataIndex: 'manifiesto'}																];        //var hoy = new Date();        //var manana = new Date();        //manana.setDate(manana.getDate() - 1);        this.dockedItems= [{	            dock: 'left',	            xtype: 'toolbar',	            width:257,	            items: [	                    {xtype: 'label', text:'Datos de Búsqueda', labelStyle: 'font-weight:bold'},	                    {xtype: 'label', text:'Manifiesto Salida:'},					    {  xtype: 'textfield', id:'idmanifiesto'+my_scope.id, maxLength:30, allowBlank:true,width:150},					    {text:'Guías Manifiesto  FXC',tooltip: "Muestra las guías que se agregaron a un manifiesto FXC",iconCls:'buscar_blue', 					            	handler:this.consultaRegistrosManifiesto,scope:this  },					    {xtype: 'tbseparator'}, 	     						   {xtype: 'label', text:'Manifiesto FXC:'},					   {  xtype: 'textfield', id:'idmanifiestofxc'+my_scope.id, maxLength:30, allowBlank:true,width:150}, 					    {text: "Reimprimir Manifiesto FXC",iconCls:'print_orange', handler:this.generaReimpresionManifiesto,scope:this },					            	  {xtype: 'tbseparator'}, 						            {text: "Limpiar",handler:this.limpiar,scope:this }	            ]	        },	        {	            dock: 'right',	            xtype: 'toolbar',	            items: [	                    {xtype: 'label', text:'Datos para Generar Manifiesto', labelStyle: 'font-weight:bold'},	                    {xtype: 'label', text:'Viaje:'},	                    {xtype: 'myUpperCaseTextField', name:'viaje', id:'id_manifiesto_viaje'+my_scope.id,maxLength:10,enforceMaxLength:true},	                    {xtype: 'label', text:'Tramo:'},	                    {xtype: 'myUpperCaseTextField', name:'viaje', id:'id_manifiesto_tramo'+my_scope.id,maxLength:10,enforceMaxLength:true},	                    {xtype: 'label', text:'Supervisor:'},	                    {xtype: 'myUpperCaseTextField', name:'supervisor',id:'id_manifiesto_supervisor'+my_scope.id,maxLength:50,enforceMaxLength:true},	                    {xtype: 'label', text:'Operador1:'},	                    {xtype: 'myUpperCaseTextField', name:'operador1',id:'id_manifiesto_operador1'+my_scope.id,maxLength:50,enforceMaxLength:true},	                    {xtype: 'label', text:'Operador2:'},	                    {xtype: 'myUpperCaseTextField', name:'operador2',id:'id_manifiesto_operador2'+my_scope.id,maxLength:50,allowBlank: true,enforceMaxLength:true},	                    {xtype: 'label', text:'Economico:'},	                    {xtype: 'myUpperCaseTextField', name:'economico',id:'id_manifiesto_economico'+my_scope.id,maxLength:10,allowBlank: true,enforceMaxLength:true},	                    {xtype: 'label', text:'Cincho:'},	                    {xtype: 'myUpperCaseTextField', name:'cincho',id:'id_manifiesto_cincho'+my_scope.id,maxLength:10,allowBlank: true,enforceMaxLength:true},	                    {xtype: 'label', text:'Excluir Guías(Separador -ENTER-):'},	                    {	                        xtype     : 'myUpperCaseTextArea',	                        id:'id_excluir_guias'+my_scope.id,maxLength:10,	                        grow      : true,	                        name      : 'guias',	                        anchor    : '100%',	                        height :90	                    },	                    {text: "Genera Manifiesto",iconCls:'print_orange', handler:this.generaManifiesto,scope:this }	            ]	        }	        ];                				this.callParent();    },    limpiar:function(){    	var myscope_main =this;    	Ext.getCmp('idmanifiesto'+myscope_main.id).setValue('');    	Ext.getCmp('idmanifiestofxc'+myscope_main.id).setValue('');		Ext.getCmp('id_manifiesto_viaje'+myscope_main.id).setValue('');		Ext.getCmp('id_manifiesto_tramo'+myscope_main.id).setValue();		Ext.getCmp('id_manifiesto_supervisor'+myscope_main.id).setValue('');		Ext.getCmp('id_manifiesto_operador1'+myscope_main.id).setValue('');		Ext.getCmp('id_manifiesto_operador2'+myscope_main.id).setValue('');		Ext.getCmp('id_manifiesto_economico'+myscope_main.id).setValue('');		Ext.getCmp('id_manifiesto_cincho'+myscope_main.id).setValue('');		 Ext.getCmp('id_excluir_guias'+myscope_main.id).setValue('');		 myscope_main.getView().getStore().removeAll();    },       consultaRegistrosManifiesto:function(){    	var myscope= this;					myscope.getView().getStore().reload(				{					params:{						manifiesto:Ext.getCmp('idmanifiesto'+myscope.id).getValue(),						consultaGuiasManifiesto:true						},					callback:function(r,options,success){						 if (r.length<=0){							 mensajeWarning('No existe información con el criterio de búsqueda selecionados');  													 }					 }	  				});    },         generaManifiesto:function(){    	var myscope_main = this;    	var manifiesto = Ext.getCmp('idmanifiesto'+myscope_main.id).getValue();    	if (manifiesto==''){			mensajeAlert("Capture el manifiesto de salida.");			return;		}		if (manifiesto.indexOf("SA")<0){			mensajeAlert("Dato capturado no corresponde a un manifiesto de salida.");			return;		}		var mensaje = 'Serán manifestados todos los registros FXC que esten ' + 			+' incluidos en el manifiesto ' + manifiesto +' y se generará manifiesto '+			' uno nuevo con el prefijo FC pero y mismo consecutivo .¿Desea continuar?';		   	 	Ext.MessageBox.confirm('Confirmación',mensaje, function(id, text){      		if ( (id === 'yes')  || (id === 'si') || (id === 'y' ) || (id === 's' ) ){       			      			myscope_main.configuraManifiesto(myscope_main,"");      		}      	 },myscope_main);    },        configuraManifiesto:function(myscope_main,transportista){    	    	var manifiesto = Ext.getCmp('idmanifiesto'+myscope_main.id).getValue();    	if (manifiesto==''){			mensajeAlert("Capture el manifiesto de salida.");			return;		}		if (manifiesto.indexOf("SA")<0){			mensajeAlert("Dato capturado no corresponde a un manifiesto de salida.");			return;		}	    	var rows =  this.getView().getSelectionModel().getSelection();		var guias_grid_seleccionadas = "";		for(i=0;i<rows.length;i++){						guias_grid_seleccionadas = guias_grid_seleccionadas +rows[i].get("idenvio")+",";					}		if (!isValidValueCampoRaw('id_manifiesto_viaje'+myscope_main.id, 'Dato del Tramo inválido')){;			return;		}		if (!isValidValueCampoRaw('id_manifiesto_tramo'+myscope_main.id, 'Dato del Tramo inválido')){;			return;		}		if (!isValidValueCampoRaw('id_manifiesto_supervisor'+myscope_main.id, 'Dato del Supervisor inválido')){;			return;		}		if (!isValidValueCampoRaw('id_manifiesto_operador1'+myscope_main.id, 'Dato del Operador1 inválido')){;			return;		}		if (!isValidValueCampoRaw('id_manifiesto_operador2'+myscope_main.id, 'Dato del Operador2 inválido')){;			return;		}		if (!isValidValueCampoRaw('id_manifiesto_economico'+myscope_main.id, 'Dato del Economico inválido')){;			return;		}		if (!isValidValueCampoRaw('id_manifiesto_cincho'+myscope_main.id, 'Dato del Cincho inválido')){;			return;		}		var manifiesto_viaje = Ext.getCmp('id_manifiesto_viaje'+myscope_main.id).getValue();		var manifiesto_tramo = Ext.getCmp('id_manifiesto_tramo'+myscope_main.id).getValue();		var manifiesto_supervisor = Ext.getCmp('id_manifiesto_supervisor'+myscope_main.id).getValue();		var manifiesto_operador1= Ext.getCmp('id_manifiesto_operador1'+myscope_main.id).getValue();		var manifiesto_operador2 = Ext.getCmp('id_manifiesto_operador2'+myscope_main.id).getValue();		var manifiesto_economico = Ext.getCmp('id_manifiesto_economico'+myscope_main.id).getValue();		var manifiesto_cincho = Ext.getCmp('id_manifiesto_cincho'+myscope_main.id).getValue();		var manifiesto = Ext.getCmp('idmanifiesto'+myscope_main.id).getValue();				var guias_lista = Ext.getCmp('id_excluir_guias'+myscope_main.id).getValue();		if (guias_lista.trim().length>0){			guias_lista = guias_lista.replace(new RegExp('\r?\n','g'), ',');					}		var guias = guias_grid_seleccionadas + guias_lista;		//Asigna los envios a la ruta de recoleccion		var url='../manifiestomovimientos/generaManifiestoSalidasFXC?manifiesto_viaje=' + manifiesto_viaje +		'&manifiesto_tramo= ' + manifiesto_tramo +'&manifiesto_supervisor='+manifiesto_supervisor+		'&manifiesto_operador1='+manifiesto_operador1+'&manifiesto_operador2='+manifiesto_operador2+		'&manifiesto_cincho='+manifiesto_cincho+'&manifiesto='+manifiesto+		'&manifiesto_economico='+manifiesto_economico+  "&guias="+guias;				visorPDF(				'utils-win-vistaprevia-pdf_file_fxc'+ manifiesto+myscope_main.id,				"Visor Manifiesto" ,	url);    },    generaReimpresionManifiesto:function(){    	var myscope_main = this;    	    	var manifiesto = Ext.getCmp('idmanifiestofxc'+myscope_main.id).getValue();    	if (manifiesto.indexOf("FC")<0){			mensajeAlert("Dato capturado no corresponde a un manifiesto de FXC para reimpresión.");			return;		}		var url='../manifiestomovimientos/reimprimeManifiesto?manifiesto='+manifiesto+ 		"&tipomanifiesto=FXC";				visorPDF(				'utils-win-vistapreviareimprime-pdf_file_envio'+ manifiesto,				"Visor Manifiesto" ,	url);    	    },	getRowsSelected : function() {		return this.getView().getSelectionModel()				.getSelection();	}	});