Ext.define('MyDesktop.view.GridAdministracionTarea', {    extend: 'Ext.grid.Panel',    requires: [        'Ext.grid.column.Action',        'Ext.grid.plugin.CellEditing',        'Ext.form.field.Text',        'Ext.toolbar.TextItem'    ],    stateful: true,    collapsible: false,    multiSelect: true,    stateId: 'stateGridAdministracionTarea',    viewConfig: {        stripeRows: true,        enableTextSelection: true    },	id:undefined,	isConsulta:false,	myScope:undefined,    initComponent: function () {		 this.editing = Ext.create('Ext.grid.plugin.CellEditing',{clicksToEdit: 1});		 this.plugins = this.editing;		 this.myScope=this;		 var sm = Ext.create('Ext.selection.CheckboxModel',{mode : 'SINGLE'});		this.selModel= sm;		 this.bbar=[												{ text: 'Mostrar Detalles',iconCls: 'detalles',handler:this.showDetails, scope:this.myScope },						  						{xtype: 'tbfill'},						{ text: 'Agregar',iconCls: 'agregar',handler:this.agregar, scope:this.myScope },						{xtype:'tbseparator'},						{ text: 'Modificar',iconCls: 'editar',handler:this.modificar,scope:this.myScope },						{xtype:'tbseparator'},						{ text: 'Borrar',iconCls: 'borrar',handler:this.eliminar,scope:this.myScope },															];		this.store = Ext.create('MyDesktop.store.StoreTareas',{});		this.selType= 'checkboxmodel';        this.columns = [                        //idtarea                	{                		xtype: 'actioncolumn',menuDisabled: true,sortable: false,width: 65,text: 'Ambito',						items: [							{								getClass: function(v, meta, rec) { return rec.get('ambito') },								getTip: function(v, meta, rec) {return rec.get('ambito') },								handler: function(grid, rowIndex, colIndex) {									//var rec = grid.getStore().getAt(rowIndex),									//action = (rec.get('estatus') ==1 ? 'Activo' : 'Desactivado');									//alertMsg(action, action + ' ' + rec.get('nombre'));								}							}						]					},    					{                		xtype: 'actioncolumn',menuDisabled: true,sortable: false,width: 70,text: 'Estatus',						items: [							{								getClass: function(v, meta, rec) { return rec.get('estatus'); },								getTip: function(v, meta, rec) {return rec.get('estatus'); },								handler: function(grid, rowIndex, colIndex) {									//var rec = grid.getStore().getAt(rowIndex),									//action = (rec.get('estatus') ==1 ? 'Activo' : 'Desactivado');									//alertMsg(action, action + ' ' + rec.get('nombre'));								}							}						]					}, 					{                		xtype: 'actioncolumn',menuDisabled: true,sortable: false,width: 60	,text: 'Tipo',						items: [							{								getClass: function(v, meta, rec) { return rec.get('tipo'); },								getTip: function(v, meta, rec) {return rec.get('tipo'); },								handler: function(grid, rowIndex, colIndex) {									//var rec = grid.getStore().getAt(rowIndex),									//action = (rec.get('estatus') ==1 ? 'Activo' : 'Desactivado');									//alertMsg(action, action + ' ' + rec.get('nombre'));								}							}						]					}, 					{                		xtype: 'actioncolumn',menuDisabled: true,sortable: false,width: 70,text: 'Urgencia',						items: [							{								getClass: function(v, meta, rec) { return rec.get('importancia'); },								getTip: function(v, meta, rec) {return rec.get('importancia'); },								handler: function(grid, rowIndex, colIndex) {									//var rec = grid.getStore().getAt(rowIndex),									//action = (rec.get('estatus') ==1 ? 'Activo' : 'Desactivado');									//alertMsg(action, action + ' ' + rec.get('nombre'));								}							}						]					}, 					{text: 'Expira el',width: 100,sortable : true,dataIndex: 'fechaexpira'},					{text: 'Asociado a',width: 100,sortable : true,dataIndex: 'idambitotarea', hidden:true},										{text: 'Fecha Ult.Estatus',width: 100,sortable : true,dataIndex: 'fechacambioestatus', hidden:true},														{text: 'Tarea Origina',width: 100,sortable : true,dataIndex: 'idtareaorigina',hidden:true},					{text: 'Creador',width: 100,sortable : true,dataIndex: 'idusuariogenero'},					{text: 'Responsable',width: 100,sortable : true,dataIndex: 'idusuarioresponsable'},					{text: 'Fecha Creaci�n',width: 100,sortable : true,dataIndex: 'fechasolicitud', hidden:true},					{text: 'Titulo ',width: 300,sortable : true,dataIndex: 'titulo', hidden:false},						{text: 'Solicitud',width: 370,sortable : true,dataIndex: 'solicitud'},					{text: 'Soluci�n',width: 350,sortable : true,dataIndex: 'solucion', hidden:true}			];        			this.callParent();    },	agregar:function(){		//Crea una forma de clientes para agregar los datos		var forma_agregar = Ext.create('MyDesktop.view.FormTarea',{id:'agregar_tarea',operacion:'insert',			main_grid:this}); 		var win = Ext.create('widget.window', {			id:'utils-win-agregar-Tarea',			title: "Agregar Datos Tarea",			iconCls: 'agregar',			width: 750,			height: 570,			modal:true,			plain: true,			headerPosition: 'right',			layout: 'fit',			items: forma_agregar					});		forma_agregar.setMainWindows(win);		win.show();			},	modificar:function(){		var rows =  this.getView().getSelectionModel().getSelection();     	if(rows.length <=0){     		alertMsg('Verificar',"Debe un registro para modificar.");     		return;     	}		if(rows.length >1){     		alertMsg('Verificar',"Seleccione solamente un registro a modificar.");     		return;     	}		//Crea una forma de clientes para agregar los datos		var forma_agregar = Ext.create('MyDesktop.view.FormTarea',{id:'agregar_tarea',operacion:'update', main_grid:this}); 		forma_agregar.updateCampos(rows[0]);				var win = Ext.create('widget.window', {			id:'utils-win-update-Tarea',			title: "Actualiza Datos Tarea",			iconCls: 'editar',			width: 750,			height: 570,			modal:true,			plain: true,			headerPosition: 'right',			layout: 'fit',			items: forma_agregar					});				forma_agregar.setMainWindows(win);		win.show();	},			eliminar:function(){			var rows =  this.getView().getSelectionModel().getSelection();			var myscope= this;	     	if(rows.length <=0){	     		mensajeAlert("Seleccione los registros que desea borrar.");	     		return;	     	}				      	 Ext.MessageBox.confirm('Confirmar','Desea eliminar los registros seleccionados?', function(id, text){		       		if ( (id === 'yes')  || (id === 'si') || (id === 'y' ) || (id === 's' ) ){ 		       		//Obtiene todos los registros seleccionados		       			var registros ='';		       			for (i=0;i<rows.length;i++){		       						       				registros = registros+  rows[i].get('idtarea')+ "|";		       			}		       			var conn = new Ext.data.Connection();		       			conn.request({		       				url: '../tareas/delete' ,		       				params:{ids:registros, estatus:0},		       				success: function(response, opts) {		       					var obj = Ext.decode(response.responseText);		       					mensajeConfirm(obj.message)		       					myscope.loadInfo();		       				},		       				failure: function(response, opts) {		       					var obj = Ext.decode(response.responseText);		       					alertMsg('Error',obj.message);		       				}		       			});		       		}		       	 },this);	},	showDetails:function(){			var rows =  this.getView().getSelectionModel().getSelection();     	if(rows.length <=0){     		alertMsg('Verificar',"Debe un registro para consultar.");     		return;     	}		if(rows.length >1){     		alertMsg('Verificar',"Seleccione solamente un registro a consultar.");     		return;     	}		//Crea una forma de clientes para agregar los datos		var forma_agregar = Ext.create('MyDesktop.view.FormTarea',{id:'consultar_tarea',operacion:'ninguna', main_grid:this, showReadOnly:true}); 		forma_agregar.updateCampos(rows[0]);			Ext.create('widget.window', {			id:'utils-win-consulta-Tarea',			title: "Datos de la Tarea",			iconCls: 'detalles',			width: 750,			height: 570,			modal:true,			plain: true,			headerPosition: 'right',			layout: 'fit',			items: forma_agregar					}).show();		},	loadInfo:function(){		this.getView().getStore().load();		},	commitInfo:function(){		this.getView().getStore().save( );		this.getView().getStore().commitChanges();		},	saveInfo:function(){		this.getView().getStore().save( );		this.getView().getStore().commitChanges();		this.loadInfo();		},	getRowsSelected:function(){		return this.getView().getSelectionModel().getSelection();	}	});